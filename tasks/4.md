# Задание 4

Реализовать возможность конфигурирования сервиса и сохранение состояния на диск.

## Функциональные требования

1. Добавить периодическое сохранение снимка хранилища на диск в любом удобном
   формате (по умолчанию выключено). Пользователь должен иметь возможность
   задать периодичность сохранения данных на диск.

1. Поддержать восстановление данных библиотеки из снимка, если это
   было запрошено пользователем.

1. Реализовать вычитывание переменных окружения при запуске сервиса.
   В случае отсутствия переменной использовать значения по умолчанию.

   Ниже перечислены названия переменных и их значения по умолчанию
   (пуста строка после `=` означает, что переменная не имеет значения
   по умолчанию):

   ```bash
   # Адрес, по которому сервис предоставляет доступ к HTTP API:
   export HTTP_LISTEN_ADDRESS=127.0.0.1:8080

   # Путь к файлу, в котором сервис хранит снимок хранилища:
   export SNAPSHOT_PATH=

   # Восстановить значение из снимка при старте системы (0 или 1):
   export RESTORE_FROM_SNAPSHOT=

   # Периодичность сохранения снапшотов на диск (в миллисекундах):
   export SNAPSHOT_SAVE_PERIOD=
   ```

## Не функциональные требования

1. Любое некорректное значение в переменных окружения должно приводить к
   аварийному завершению работы сервиса.

1. Если пользователь запросил восстановление данных, однако по указанному
   пути снимок не существует или недоступен, сервис должен аварийно завершиться.

1. Написать юнит-тесты на новый код.

## Материалы для ознакомления

- [Viper](https://github.com/spf13/viper) - библиотека для реализации
  конфигурирования сервиса из различных источников.

- [go-snaps](https://github.com/gkampitakis/go-snaps) - библиотека для
  организации снапшотного тестирования.

- [Golang Defer: From Basic To Traps][defer-howto] - очень подробный обзор
  особенностей использования defer от самых простых вещей до деталей внутренней
  реализации.

[defer-howto]: https://victoriametrics.com/blog/defer-in-go/index.html
